---
layout: default
title: Realtime Usage
---
<div id="map" class="status"></div>

<script>
    var map = L.map('map').fitBounds([[75,-160], [-45,160]]);

    var tiles = L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {
        attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors',
    }).addTo(map);

    var heat = L.heatLayer([], {
        minOpacity: .4,
        radius: 20
    }).addTo(map);

    var ws = new WebSocket("wss://cgeo-status.herokuapp.com/api/locations");
    var heatmapData = [];
    ws.onmessage = function(msg) {
        var data = JSON.parse(msg.data);
        data.clients.map(function(client) {
            // client.kind[0].toUpperCase(); // version
            heatmapData.push([client.latitude, client.longitude]);
        });
        if (heatmapData.length > 5000) {
            heatmapData.splice(heatmapData.length - 5000);
        }
        heat.setLatLngs(heatmapData);
    };
</script>
